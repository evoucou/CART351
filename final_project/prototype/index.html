
<!DOCTYPE html>
<html>


<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
  integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
  crossorigin=""/>

  <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
  integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
  crossorigin=""></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="jscolor.js"></script>
  <!-- <script type="text/javascript" src="map.js"></script> -->
  <link rel="stylesheet" href="main.css"/>


    <script type="text/javascript">
      handleOnLoad = function() {
        L.Icon.Default.imagePath = 'https://unpkg.com/leaflet@0.7.7/dist/images/';
      }
    </script>
    <link  href="https://unpkg.com/leaflet-geosearch@latest/assets/css/leaflet.css" rel="stylesheet" />
<script src="https://unpkg.com/leaflet-geosearch@latest/dist/bundle.min.js"></script>
</head>

  <body>
    <div id="header">
    <img src="sources/plus.svg" id="newrequest" onclick="toggleNewReqMenu()"/>
    <img src="sources/logo.svg" id="logo"/><br>
  <input type="text" placeholder="search for a request..." name="search" id="searchbar">
  </div>
      <div id="newReqMenu"><div id="newReqTextBox"><form>
        <h2>NEW REQUEST</h2>
        <input type="search" name="title" placeholder="Type in your request..." id="titleBox">
        <!--<input type="color" id="colorPicker">-->
        <br><br>
        <input type="text" name="position" placeholder="Use current location" id="locationBox"><br>

      <br><button class="jscolor {width: 280, height: 260, position:'center' , onFineChange:'update(this)', valueElement:null, closable:true}" id="colorPicker">
        Choose your pin's color
</button><br>
<p id="test">Test. This will be the picker.</p></form><br><br>
<button id="submitButton" onclick="createPinCurLoc()">Submit</button></div></div>
  <div id="map"></div>




    <!--   border-width: 0;

      -moz-box-shadow:    inset 0 0 3px #E6E6E6;
      -webkit-box-shadow: inset 0 0 3px #E6E6E6;
      box-shadow:         inset 0 0 3px #E6E6E6;-->
<script>

var GeoSearchControl = window.GeoSearch.GeoSearchControl;
var OpenStreetMapProvider = window.GeoSearch.OpenStreetMapProvider;

// remaining is the same as in the docs, accept for the var instead of const declarations
var provider = new OpenStreetMapProvider();

var searchControl = new GeoSearchControl({
  provider: provider,
});

const map = new L.map('map', {
    center: [45.50884, -73.58781],
    setView: true,
    zoom: 13
});

map.addControl(searchControl);

//).locate({setView: true, maxZoom: 13});
//map.addControl(searchControl);
//Initially we locate the user's position to load the map around

/*Longitude of Montreal: -73.567256

Latitude of Montreal: 45.5016889*/


L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    //attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoiZXZvdWNvdSIsImEiOiJjam83ZnJrb3UwZWI2M3FvOW0zNzIwZXRnIn0.2HBTS6fDGxp1pjp54zflnw'
}).addTo(map);

function onLocationFound(e) {
  // We then zoom the position of the user and add a pin.
        //map.locate({setView: true, maxZoom: 18, watch: true});
        //map.zoomIn(2, true);

        L.marker(e.latlng)
    .bindPopup('Hello world!')
    .on('click', function() { alert('Clicked on a member of the group!'); })
    .addTo(map);
}

      map.on('locationfound', onLocationFound);
var reqTitle;

function createPinCurLoc() {
  reqTitle = document.getElementById('titleBox').value;
  console.log(reqTitle);

    map.locate({setView: true, maxZoom: 16});
    console.log("create pin");

    e.style.display="none";
}

var e = document.getElementById("newReqMenu");
e.style.display="none";


function getRandomColor() {
var letters = '0123456789ABCDEF';
var color = '#';
for (var i = 0; i < 6; i++) {
color += letters[Math.floor(Math.random() * 16)];
}
return color;
}

var randomStartColor;

function toggleNewReqMenu() {
  console.log("click");

  randomStartColor = getRandomColor();

if (e.style.display === "none") {
    e.style.display = "block";
    e.style.position = "fixed";
    //Initial values
    document.getElementById('titleBox').value = '';
    document.getElementById('locationBox').value = '';
    document.getElementById('colorPicker').style.backgroundColor = randomStartColor;
    document.getElementById('test').style.color = randomStartColor;


} else {
    e.style.display = "none";
}

//updatePinColor();

}

function update(jscolor) {
    // 'jscolor' instance can be used as a string
    document.getElementById('test').style.color = '#' + jscolor
}

//OLD COLOR PICKER
  /* function updatePinColor() {
    var color;
    var defaultColor = randomStartColor;

    var p = document.querySelector("#test");
    p.style.color = defaultColor;

    color = document.querySelector("#colorPicker");
    color.addEventListener("input", updateFirst, false);
    //color.addEventListener("change", updateAll, false);
    color.select();

  function updateFirst(event) {
      p.style.color = event.target.value;
}

}*/

//document.getElementById("newrequest").addEventListener("click", toggleNewReqMenu);




function onLocationError(e) {
    alert(e.message);
}

map.on('locationerror', onLocationError);

</script>

  </body>

  </html>
